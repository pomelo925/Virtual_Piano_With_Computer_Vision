FROM nvidia/cuda:12.6.0-cudnn-devel-ubuntu22.04

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Asia/Taipei

# ==========================================================
# Basic tools + Python
# ==========================================================
RUN apt-get update && \
    apt-get install -y \
        python3 python3-pip python3-venv \
        wget curl git sudo udev usbutils \
        gnupg2 lsb-release pkg-config \
        build-essential cmake && \
    ln -sf /usr/bin/python3 /usr/bin/python && \
    ln -sf /usr/bin/pip3 /usr/bin/pip

# ==========================================================
# Python venv
# ==========================================================
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
RUN pip install --upgrade pip

WORKDIR /app

# ==========================================================
# ONLY pyrealsense2 (no librealsense2)
# ==========================================================
RUN pip install --no-cache-dir pyrealsense2

# ==========================================================
# Mediapipe + OpenCV + Numpy + Pygame
# ==========================================================
RUN pip install --no-cache-dir \
    "opencv-python-headless>=4.5.0" \
    "mediapipe>=0.8.0" \
    "numpy>=1.19.0" \
    "pygame>=2.0.0"

# ==========================================================
# System GUI + ALSA
# ==========================================================
RUN apt-get update && apt-get install -y \
    libgl1 \
    libglib2.0-0 \
    libxcb-xinerama0 \
    libxcb-xinerama0-dev \
    libxkbcommon-x11-0 \
    libxcb1 \
    libx11-xcb1 \
    libxcb-icccm4 \
    libxcb-image0 \
    libxcb-keysyms1 \
    libxcb-render-util0 \
    libxcb-shape0 \
    libxcb-sync1 \
    libxcb-xfixes0 \
    alsa-utils \
    libasound2 \
    libasound2-dev \
    libv4l-0

CMD ["bash"]
