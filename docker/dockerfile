FROM nvidia/cuda:12.6.0-cudnn-devel-ubuntu22.04

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Asia/Taipei

# 安裝 Python3.10（Ubuntu 22.04 預設）與 pip
RUN apt-get update && \
    apt-get install -y python3 python3-pip python3-venv && \
    ln -sf /usr/bin/python3 /usr/bin/python && \
    ln -sf /usr/bin/pip3 /usr/bin/pip

# 建立虛擬環境（避免系統 pip 汙染，更安全）
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"

# 更新 pip
RUN pip install --upgrade pip

WORKDIR /app

# mediapipe + opencv + numpy + pygame
RUN pip install --no-cache-dir \
    "opencv-python-headless>=4.5.0" \
    "mediapipe>=0.8.0" \
    "numpy>=1.19.0" \
    "pygame>=2.0.0"

RUN apt-get update && apt-get install -y \
    libgl1 \
    libglib2.0-0

CMD ["bash"]
